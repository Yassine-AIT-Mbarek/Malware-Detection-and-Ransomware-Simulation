import os
import yara
import tkinter as tk
from tkinter import filedialog, messagebox
from tkinter import ttk
from PIL import Image, ImageTk
def resource_path(relative_path):
    try:
        base_path = sys._MEIPASS
    except Exception:
        base_path = os.path.abspath(".")
    return os.path.join(base_path, relative_path)
    
# Compile YARA rules
rules = yara.compile(filepath=(resource_path('malware_rules.yar')))

def scan_directory(directory):
    malware_found = []
    for root, _, files in os.walk(directory):
        for file in files:
            file_path = os.path.join(root, file)
            try:
                matches = rules.match(file_path)
                if matches:
                    malware_found.append(file_path)
            except Exception as e:
                print(f"Error scanning file {file_path}: {e}")
    
    if malware_found:
        messagebox.showwarning("Malware Detected", f"Malware detected in the following files:\n" + "\n".join(malware_found))
    else:
        messagebox.showinfo("Scan Complete", "No malware detected.")

def select_directory():
    directory = filedialog.askdirectory()
    if directory:
        scan_directory(directory)

root = tk.Tk()
root.title("Malware Detector")

background_image = Image.open("Blackbeard.png")
background_photo = ImageTk.PhotoImage(background_image)

frame = ttk.Frame(root)
frame.pack(fill=tk.BOTH, expand=True)

background_label = ttk.Label(frame, image=background_photo)
background_label.place(relx=0, rely=0, relwidth=1, relheight=1)

style = ttk.Style()
style.configure("TButton", foreground="black", background="#5AC9EA", font=("Helvetica", 12))

style.configure("TLabel", foreground="black", font=("Helvetica", 12))

label = ttk.Label(frame, text="Select a directory to scan for malware:")
label.grid(row=0, column=0, padx=10, pady=10)

select_button = ttk.Button(frame, text="Select Directory", command=select_directory)
select_button.grid(row=1, column=0, padx=10, pady=10)

root.mainloop()
